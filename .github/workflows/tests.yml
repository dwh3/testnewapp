name: Build Validation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Validate HTML structure
      run: |
        echo "Checking for critical files..."
        test -f index.html || exit 1
        test -f login.html || exit 1
        test -f js/app.js || exit 1
        test -f js/storage.js || exit 1
        test -f js/crypto.js || exit 1
        test -d js/config || exit 1
        echo "‚úÖ All critical files present"

    - name: Check JavaScript syntax
      run: |
        echo "Checking JavaScript syntax..."
        for file in js/*.js js/config/*.js; do
          if [ -f "$file" ]; then
            node --check "$file" || exit 1
          fi
        done
        echo "‚úÖ JavaScript syntax valid"

    - name: Verify manual test files exist
      run: |
        echo "Checking manual test infrastructure..."
        test -f tests/manual/test-crypto.html || exit 1
        test -f tests/manual/test-storage.html || exit 1
        test -f tests/manual/test-config.html || exit 1
        test -f tests/manual/test-edit-delete.html || exit 1
        echo "‚úÖ Manual test files present"

    - name: Documentation check
      run: |
        echo "Verifying documentation..."
        test -f TESTING.md || exit 1
        test -f SECURITY.md || exit 1
        test -f CONFIG.md || exit 1
        test -f CHANGELOG.md || exit 1
        test -f FUNCTIONALITY_STATUS.md || exit 1
        echo "‚úÖ Documentation present"

    - name: Configuration validation
      run: |
        echo "Validating configuration files..."
        test -f js/config/default.js || exit 1
        test -f js/config/development.js || exit 1
        test -f js/config/production.js || exit 1
        test -f js/config/index.js || exit 1
        echo "‚úÖ Configuration files present"

    - name: Summary
      run: |
        echo "================================"
        echo "‚úÖ Build validation passed!"
        echo ""
        echo "üìù Note: This project uses manual testing."
        echo "   Run tests by opening files in tests/manual/"
        echo ""
        echo "Files validated:"
        echo "  - HTML structure"
        echo "  - JavaScript syntax"
        echo "  - Configuration files"
        echo "  - Documentation"
        echo "  - Manual test infrastructure"
        echo "================================"
